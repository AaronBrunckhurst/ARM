<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotic Arm Control</title>
    <script>
        async function getJoint(jointIndex) {
            const response = await fetch(`/get_joint?joint_index=${jointIndex}`);
            if (!response.ok) return null;
            const data = await response.json();
            return data.joint_angle;
        }

        async function setJoint(jointIndex, jointAngle) {
            const response = await fetch("/set_joint", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ joint_index: jointIndex, joint_angle: jointAngle })
            });
            updateStatus(response.ok ? "Joint set successfully" : "Failed to set joint");
        }

        async function toggleGripper(state) {
            const response = await fetch(state ? "/gripper_open" : "/gripper_close", { method: "POST" });
            updateStatus(response.ok ? (state ? "Gripper opened" : "Gripper closed") : "Failed to toggle gripper");
        }

        async function moveArm(direction) {
            let moveAmount = parseInt(document.getElementById("moveSlider").value);
            let joint0, joint1, joint2;
            switch (direction) {
                case 'left':
                    joint0 = await getJoint(0);
                    if (joint0 !== null) await setJoint(0, joint0 - moveAmount);
                    break;
                case 'right':
                    joint0 = await getJoint(0);
                    if (joint0 !== null) await setJoint(0, joint0 + moveAmount);
                    break;
                case 'up':
                    joint1 = await getJoint(1);
                    joint2 = await getJoint(2);
                    if (joint1 !== null && joint2 !== null) {
                        await setJoint(1, joint1 + moveAmount);
                        await setJoint(2, joint2 + moveAmount);
                    }
                    break;
                case 'down':
                    joint1 = await getJoint(1);
                    joint2 = await getJoint(2);
                    if (joint1 !== null && joint2 !== null) {
                        await setJoint(1, joint1 - moveAmount);
                        await setJoint(2, joint2 - moveAmount);
                    }
                    break;
            }
            updateStatus(`Moved ${direction} by ${moveAmount}`);
        }

        function updateStatus(message) {
            document.getElementById("statusLabel").innerText = message;
        }
    </script>
</head>
<body>
    <h1 style="text-align: center;">Robotic Arm Control</h1>
    
    <div style="display: flex; justify-content: center;">
        <img src="/get_arm_cam_stream" width="640" height="480" />
    </div>
    
    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 10px;">
        <input type="range" id="moveSlider" min="1" max="20" value="10" style="width: 90%;">
        <p>Move Amount: <span id="sliderValue">10</span></p>
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 10px;">
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button style="font-size: 20px; padding: 15px; width: 120px;" onclick="moveArm('up')">⬆ Up</button>
        </div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 5px;">
            <button style="font-size: 20px; padding: 15px; width: 120px;" onclick="moveArm('left')">⬅ Left</button>
            <button style="font-size: 20px; padding: 15px; width: 120px;" onclick="moveArm('right')">➡ Right</button>
        </div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 5px;">
            <button style="font-size: 20px; padding: 15px; width: 120px;" onclick="moveArm('down')">⬇ Down</button>
        </div>
    </div>
    
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
        <button style="font-size: 20px; padding: 15px; width: 150px;" onclick="toggleGripper(true)">Open Gripper</button>
        <button style="font-size: 20px; padding: 15px; width: 150px;" onclick="toggleGripper(false)">Close Gripper</button>
    </div>
    
    <div style="text-align: center; margin-top: 10px;">
        <h2>Status</h2>
        <p id="statusLabel">Waiting for command...</p>
    </div>
    
    <script>
        document.getElementById("moveSlider").addEventListener("input", function() {
            document.getElementById("sliderValue").innerText = this.value;
        });
    </script>
</body>
</html>
